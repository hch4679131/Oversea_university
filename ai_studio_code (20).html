<!DOCTYPE html>
<html lang="zh-CN" x-data="app()" @scroll.window="handleScroll" @resize.window="handleResize" x-cloak>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKSD Club | æ±‡ç”Ÿä¼š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Noto+Serif+SC:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Lato', 'sans-serif'],
                        serif: ['"Playfair Display"', '"Noto Serif SC"', 'serif'],
                    },
                    colors: {
                        paper: { 50: '#F9F8F4', 100: '#F2F0E9', 200: '#E6E2D6' },
                        heritage: { 800: '#1A332A', 900: '#0F221C' },
                        gold: { 400: '#C6A87C', 500: '#B08D55', 600: '#8E6F3E' }
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        body { background-color: #F9F8F4; color: #1A332A; }
        .separator-line {
            height: 1px;
            background: linear-gradient(90deg, transparent, #C6A87C, transparent);
            margin: 2rem 0;
        }
        /* ä¼˜åŒ–æ€§èƒ½ */
        .will-change-transform { will-change: transform, opacity; }
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            max-width: 360px;
            padding: 14px 16px;
            border-radius: 10px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.18);
            z-index: 9999;
            color: #fff;
            font-weight: 600;
            animation: slideIn 0.25s ease-out;
        }
        .toast.success { background: #16a34a; }
        .toast.error { background: #dc2626; }
        .toast.loading { background: #2563eb; }
        @keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        /* AI èŠå¤©æµ®çª— */
        #chat-float-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #B08D55, #C6A87C);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(176, 141, 85, 0.4);
            z-index: 9998;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #chat-float-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 24px rgba(176, 141, 85, 0.5);
        }
        #chat-float-btn svg {
            width: 28px;
            height: 28px;
            stroke: #F9F8F4;
            stroke-width: 2;
        }
        
        /* å³ä¸‹è§’å’¨è¯¢æŒ‰é’®ç»„ */
        #consultation-float {
            position: fixed;
            bottom: 110px;
            right: 30px;
            z-index: 9997;
        }
        #consultation-main-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f97316, #ea580c);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #consultation-main-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 24px rgba(249, 115, 22, 0.5);
        }
        #consultation-main-btn svg {
            width: 28px;
            height: 28px;
            stroke: #F9F8F4;
            stroke-width: 2;
        }
        .consultation-options {
            position: absolute;
            bottom: 70px;
            right: 0;
            display: none;
            flex-direction: column;
            gap: 10px;
        }
        .consultation-options.show {
            display: flex;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .consultation-btn {
            padding: 12px 20px;
            background: white;
            border: 2px solid #f97316;
            color: #f97316;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }
        .consultation-btn:hover {
            background: #f97316;
            color: white;
            transform: translateX(-5px);
        }
        
        #chat-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: #F9F8F4;
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
            z-index: 9999;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        #chat-panel.open {
            right: 0;
        }
        #chat-header {
            background: linear-gradient(135deg, #0F221C, #1A332A);
            color: #F9F8F4;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .chat-message {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
        }
        .chat-message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, #B08D55, #C6A87C);
            color: #F9F8F4;
        }
        .chat-message.ai {
            align-self: flex-start;
            background: #E6E2D6;
            color: #1A332A;
            border: 1px solid #C6A87C;
        }
        #chat-input-area {
            padding: 20px;
            border-top: 1px solid #E6E2D6;
            display: flex;
            gap: 10px;
        }
        #chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #C6A87C;
            border-radius: 8px;
            background: #fff;
            color: #1A332A;
            font-size: 14px;
        }
        #chat-send-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #B08D55, #C6A87C);
            color: #F9F8F4;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        #chat-send-btn:hover:not(:disabled) {
            opacity: 0.9;
        }
        #chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="antialiased selection:bg-heritage-900 selection:text-gold-400 overflow-x-hidden">

    <!-- 1. å¯¼èˆª -->
    <nav class="fixed w-full z-50 transition-all duration-300"
         :style="`
            background-color: rgba(249, 248, 244, ${Math.min(scrollY / 100, 0.95)});
            backdrop-filter: blur(${Math.min(scrollY / 20, 10)}px);
            padding-top: ${Math.max(20 - scrollY/10, 0)}px;
            padding-bottom: ${Math.max(20 - scrollY/10, 0)}px;
            border-bottom: 1px solid rgba(26, 51, 42, ${Math.min(scrollY / 200, 0.1)});
         `">
        <div class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer">
                <div class="w-10 h-10 border-2 border-heritage-900 rounded-full flex items-center justify-center text-heritage-900 font-serif font-bold text-lg">H</div>
                <div class="flex flex-col">
                    <span class="text-xl font-serif font-bold text-heritage-900 tracking-tight leading-none">HKSD</span>
                    <span class="text-[9px] text-gold-600 font-bold uppercase tracking-[0.2em] mt-1">Since 2016</span>
                </div>
            </div>
            <div class="hidden md:flex gap-10 text-sm font-bold tracking-wide text-heritage-800/70 uppercase">
                <a href="#academia" class="hover:text-heritage-900 hover:text-gold-600 transition-all" x-text="t[lang].menu_aca"></a>
                <a href="#career" class="hover:text-heritage-900 hover:text-gold-600 transition-all" x-text="t[lang].menu_car"></a>
                <a href="#hostel" class="hover:text-heritage-900 hover:text-gold-600 transition-all" x-text="t[lang].menu_hos"></a>
            </div>
            <div class="flex items-center text-sm font-serif italic text-heritage-900 gap-4 cursor-pointer select-none">
                    <span @click="lang = 'sc'" :class="{'font-bold text-gold-600 border-b border-gold-600': lang==='sc', 'opacity-50 hover:opacity-100': lang!=='sc'}">ç®€</span>
                    <span class="opacity-30">/</span>
                    <span @click="lang = 'tc'" :class="{'font-bold text-gold-600 border-b border-gold-600': lang==='tc', 'opacity-50 hover:opacity-100': lang!=='tc'}">ç¹</span>
                    <span class="opacity-30">/</span>
                    <span @click="lang = 'en'" :class="{'font-bold text-gold-600 border-b border-gold-600': lang==='en', 'opacity-50 hover:opacity-100': lang!=='en'}">En</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- 2. Hero Section -->
    <header class="pt-40 pb-20 px-6 max-w-7xl mx-auto min-h-screen flex flex-col lg:flex-row items-center gap-16 relative perspective-1000">
        <!-- è£…é¥°åº•çº¹ -->
        <div class="absolute top-0 right-0 w-[400px] h-[400px] bg-gold-400/10 rounded-full blur-[100px] -z-10 will-change-transform"
             :style="`transform: translateY(${scrollY * 0.2}px)`"></div>

        <div class="flex flex-col lg:flex-row items-end gap-16 w-full">
            <!-- Left Text: æ»šåŠ¨æ—¶æ·¡å‡º -->
            <div class="lg:w-7/12 relative z-10 will-change-transform"
                 :style="`opacity: ${1 - p(0, 0.8)}; transform: translateY(${scrollY * 0.3}px) scale(${1 - p(0, 1) * 0.1});`">
                
                <div class="flex items-center gap-3 mb-8">
                    <div class="h-[1px] w-12 bg-heritage-900"></div>
                    <span class="font-serif italic text-heritage-800 text-lg font-bold" x-text="t[lang].hero_tag"></span>
                </div>
                
                <h1 class="text-5xl lg:text-7xl font-serif font-bold text-heritage-900 leading-[1.1] mb-8">
                    <span x-text="t[lang].hero_h1"></span><br>
                    <span class="text-gold-600 italic font-light" x-text="t[lang].hero_h2"></span>
                </h1>
                
                <p class="text-xl text-heritage-800/80 max-w-2xl leading-relaxed font-light mb-12 border-l-4 border-gold-400 pl-6" x-text="t[lang].hero_p"></p>
                
                <div class="flex gap-6">
                    <button class="bg-heritage-900 text-paper-50 px-10 py-4 font-serif font-bold tracking-wide shadow-xl transform transition hover:scale-105">
                        <span x-text="t[lang].btn_join"></span>
                    </button>
                    <button class="px-10 py-4 border border-heritage-900 text-heritage-900 font-serif font-bold tracking-wide transform transition hover:bg-heritage-900 hover:text-paper-50">
                        <span x-text="t[lang].btn_explore"></span>
                    </button>
                </div>
            </div>

            <!-- Right Big Number: å‡ ä¹ä¸åŠ¨ï¼Œä¿ç•™å¾®å°è§†å·® -->
            <div class="lg:w-5/12 w-full bg-heritage-900 text-paper-50 p-10 lg:p-16 relative shadow-2xl z-20 overflow-hidden">
                <div class="absolute top-4 left-4 right-4 bottom-4 border border-gold-500/30 will-change-transform"
                     :style="`transform: translateY(${scrollY * 0.05}px)`"></div>
                
                <div class="relative z-10 text-center lg:text-left will-change-transform"
                     :style="`transform: translateY(${scrollY * 0.08}px)`">
                    <div class="text-gold-400 font-bold uppercase tracking-widest text-xs mb-2">Community Scale</div>
                    <div class="text-7xl lg:text-8xl font-serif font-bold mb-2">90k<span class="text-gold-400">+</span></div>
                    <div class="text-xl font-serif italic opacity-80" x-text="t[lang].hero_stat"></div>
                    <div class="mt-8 h-[1px] w-full bg-white/20"></div>
                    <div class="mt-6 flex justify-between text-sm opacity-60 font-sans">
                        <span>#PhD</span><span>#Masters</span><span>#Undergrad</span><span>#Alumni</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 3. Intro Section -->
    <section class="py-24 bg-paper-100 border-y border-heritage-900/5 relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row items-center gap-16 relative z-10">
            <!-- Left Text -->
            <div class="md:w-1/2 text-center md:text-left will-change-transform"
                 :style="`opacity: ${p(0.2, 0.8)}; transform: translateY(${50 - 50 * p(0.2, 0.8)}px);`">
                <i data-lucide="feather" class="w-8 h-8 text-gold-600 mb-6 mx-auto md:mx-0"></i>
                <h2 class="text-3xl md:text-4xl font-serif font-bold text-heritage-900 mb-6 leading-snug" x-text="t[lang].intro_title"></h2>
                <div class="separator-line w-24 mx-auto md:mx-0" :style="`width: ${p(0.3, 0.9) * 6}rem`"></div>
                <p class="text-lg text-heritage-800/70 leading-loose font-serif italic" x-text="t[lang].intro_text"></p>
            </div>

            <!-- Right Image -->
            <div class="md:w-1/2 relative perspective-1000">
                <div class="relative w-full h-[400px] will-change-transform"
                     :style="`
                        opacity: ${p(0.3, 0.9)};
                        transform: translateY(${100 - 100 * p(0.3, 0.9)}px) rotateY(${-10 + 10 * p(0.3, 0.9)}deg) scale(${0.8 + 0.2 * p(0.3, 0.9)});
                     `">
                    <img src="https://images.unsplash.com/photo-1543269865-cbf427effbad?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" 
                         class="w-full h-full object-cover rounded-2xl shadow-2xl border-4 border-paper-50" 
                         alt="Discussion">
                    <!-- é®ç½©å±‚ï¼Œéšæ»šåŠ¨æ¶ˆå¤± -->
                    <div class="absolute inset-0 bg-paper-100 mix-blend-color" :style="`opacity: ${1 - p(0.4, 0.9)}`"></div>
                </div>

                <div class="absolute -bottom-6 -left-6 z-30 bg-heritage-900 text-gold-400 px-6 py-4 rounded-lg shadow-xl will-change-transform"
                     :style="`opacity: ${p(0.6, 1.0)}; transform: scale(${p(0.6, 1.0)}) translateY(${20 - 20 * p(0.6, 1.0)}px);`">
                    <span class="font-serif italic font-bold text-lg">" Your Home Away From Home "</span>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. Services -->
    <section class="py-24 max-w-7xl mx-auto px-6">
        <div class="flex flex-col md:flex-row justify-between items-end mb-16 will-change-transform"
             :style="`opacity: ${p(0.8, 1.2)}; transform: translateX(${-50 + 50 * p(0.8, 1.2)}px)`">
            <div>
                <span class="text-gold-600 font-bold uppercase tracking-widest text-xs block mb-2">Our Pillars</span>
                <h2 class="text-4xl font-serif font-bold text-heritage-900" x-text="t[lang].service_title"></h2>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-0 border border-heritage-900/10">
            <!-- Service 1 -->
            <div class="group relative bg-paper-50 p-12 border-b lg:border-b-0 lg:border-r border-heritage-900/10 hover:bg-white transition-colors duration-500 will-change-transform"
                 :style="`opacity: ${p(0.9, 1.3)}; transform: translateY(${100 - 100 * p(0.9, 1.3)}px)`">
                <div class="text-6xl text-heritage-900/5 font-serif font-bold absolute top-8 right-8">01</div>
                <h3 class="text-2xl font-serif font-bold text-heritage-900 mb-6 flex items-center gap-3"><span x-text="t[lang].aca_title"></span></h3>
                <p class="text-heritage-800/70 leading-relaxed mb-8" x-text="t[lang].aca_desc"></p>
                <ul class="space-y-3 font-serif text-heritage-900 border-t border-heritage-900/10 pt-6">
                    <li class="flex items-center gap-3"><span class="w-1.5 h-1.5 bg-gold-500 rounded-full"></span><span x-text="t[lang].aca_tag1"></span></li>
                    <li class="flex items-center gap-3"><span class="w-1.5 h-1.5 bg-gold-500 rounded-full"></span><span x-text="t[lang].aca_tag2"></span></li>
                </ul>
            </div>

            <!-- Service 2 -->
            <div class="group relative bg-paper-50 p-12 border-b lg:border-b-0 lg:border-r border-heritage-900/10 hover:bg-white transition-colors duration-500 will-change-transform"
                 :style="`opacity: ${p(1.0, 1.4)}; transform: translateY(${100 - 100 * p(1.0, 1.4)}px)`">
                <div class="text-6xl text-heritage-900/5 font-serif font-bold absolute top-8 right-8">02</div>
                <h3 class="text-2xl font-serif font-bold text-heritage-900 mb-6 flex items-center gap-3"><span x-text="t[lang].car_title"></span></h3>
                <p class="text-heritage-800/70 leading-relaxed mb-8" x-text="t[lang].car_desc"></p>
                <div class="pt-6 border-t border-heritage-900/10">
                     <p class="font-serif italic text-gold-600 mb-2">Network:</p>
                     <p class="text-sm font-bold text-heritage-900 tracking-wide">TENCENT / GOLDMAN / MCKINSEY</p>
                </div>
            </div>

            <!-- Service 3 -->
            <div class="group relative bg-paper-50 p-12 hover:bg-white transition-colors duration-500 will-change-transform"
                 :style="`opacity: ${p(1.1, 1.5)}; transform: translateY(${100 - 100 * p(1.1, 1.5)}px)`">
                <div class="text-6xl text-heritage-900/5 font-serif font-bold absolute top-8 right-8">03</div>
                <h3 class="text-2xl font-serif font-bold text-heritage-900 mb-6 flex items-center gap-3"><span x-text="t[lang].hos_title"></span></h3>
                <p class="text-heritage-800/70 leading-relaxed mb-8" x-text="t[lang].hos_desc"></p>
                <div class="pt-6 border-t border-heritage-900/10 flex gap-4">
                    <span class="border border-heritage-900/20 px-3 py-1 text-xs uppercase tracking-widest text-heritage-900">Safety</span>
                    <span class="border border-heritage-900/20 px-3 py-1 text-xs uppercase tracking-widest text-heritage-900">Community</span>
                </div>
            </div>
        </div>
    </section>

    <!-- 5. Testimonials (è°ƒæ•´äº†è§¦å‘æ—¶æœºï¼Œç¡®ä¿åº•éƒ¨å¯è§) -->
    <section class="py-24 bg-heritage-900 text-paper-100 relative overflow-hidden">
        <div class="absolute inset-0 opacity-10 will-change-transform" 
             style="background-image: url('https://www.transparenttextures.com/patterns/cubes.png');"
             :style="`transform: translateY(${scrollY * 0.1}px)`"></div>
        
        <div class="max-w-7xl mx-auto px-6 relative z-10">
            <div class="text-center mb-16 will-change-transform"
                 :style="`opacity: ${p(1.3, 1.6)}; transform: scale(${0.9 + 0.1 * p(1.3, 1.6)})`">
                <h2 class="text-4xl lg:text-5xl font-serif font-bold text-gold-400 mb-4" x-text="t[lang].testi_title"></h2>
                <p class="text-heritage-200/60 max-w-2xl mx-auto font-serif italic">Every story adds to our history.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-12">
                <template x-for="(item, index) in t[lang].testimonials" :key="index">
                    <!-- å‡å°äº†è§¦å‘é«˜åº¦èŒƒå›´ï¼Œç¡®ä¿æ—©ç‚¹æ˜¾ç¤º -->
                    <div class="relative will-change-transform" 
                         :style="`
                            opacity: ${p(1.3 + index*0.1, 1.6 + index*0.1)}; 
                            transform: translateY(${30 - 30 * p(1.3 + index*0.1, 1.6 + index*0.1)}px);
                         `">
                        <div class="text-6xl font-serif text-gold-600/20 absolute -top-8 -left-4">â€œ</div>
                        <p class="text-lg leading-relaxed font-serif text-paper-200 mb-8 indent-6" x-text="item.content"></p>
                        <div class="flex items-center gap-4 border-t border-white/10 pt-6">
                            <img :src="item.avatar" class="w-14 h-14 object-cover grayscale brightness-110 contrast-125 border border-gold-500/50" alt="Alumni">
                            <div>
                                <div class="font-bold text-gold-400 tracking-wide" x-text="item.name"></div>
                                <div class="text-xs text-white/50 uppercase tracking-widest mt-1" x-text="item.role"></div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </section>

    <!-- 6. Auth Section -->
    <section id="auth" class="py-20 bg-paper-100 border-y border-heritage-900/5">
        <div class="max-w-7xl mx-auto px-6 grid lg:grid-cols-2 gap-10">
            <div class="space-y-4">
                <h2 class="text-3xl font-serif font-bold text-heritage-900">å¿«é€Ÿæ³¨å†Œ / ç™»å½•</h2>
                <p class="text-heritage-800/70 font-serif">æ‰‹æœºå· + éªŒè¯ç ä¸€ä½“åŒ–ã€‚æ”¯æŒæ³¨å†Œã€ç™»å½•ã€é‡ç½®å¯†ç ã€‚</p>
                <div class="bg-white p-6 border border-heritage-900/10 shadow-sm">
                    <div class="grid gap-3">
                        <input id="auth-phone" type="text" placeholder="æ‰‹æœºå·" class="px-4 py-3 border border-heritage-900/15 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-400" />
                        <select id="auth-purpose" class="px-4 py-3 border border-heritage-900/15 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-400">
                            <option value="register">æ³¨å†Œ</option>
                            <option value="reset_password">é‡ç½®å¯†ç </option>
                            <option value="login">ç™»å½•</option>
                        </select>
                        <div class="flex gap-3">
                            <button id="auth-send-code" class="flex-1 bg-heritage-900 text-paper-50 py-3 rounded-md font-semibold hover:bg-heritage-800 transition">å‘é€éªŒè¯ç </button>
                            <input id="auth-code" type="text" placeholder="éªŒè¯ç " class="w-32 px-4 py-3 border border-heritage-900/15 rounded-md" />
                        </div>
                        <button id="auth-verify-code" class="bg-gold-500 text-paper-50 py-3 rounded-md font-semibold hover:bg-gold-600 transition">éªŒè¯éªŒè¯ç </button>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <h3 class="text-2xl font-serif font-bold text-heritage-900">æ³¨å†Œ / ç™»å½• / é‡ç½®</h3>
                <div class="bg-white p-6 border border-heritage-900/10 shadow-sm space-y-3">
                    <input id="auth-password" type="password" placeholder="è®¾ç½®å¯†ç ï¼ˆæ³¨å†Œï¼‰" class="w-full px-4 py-3 border border-heritage-900/15 rounded-md" />
                    <input id="auth-idcard" type="text" placeholder="èº«ä»½è¯å·ï¼ˆå¯é€‰ï¼‰" class="w-full px-4 py-3 border border-heritage-900/15 rounded-md" />
                    <input id="auth-idname" type="text" placeholder="å§“åï¼ˆä¸èº«ä»½è¯ä¸€è‡´ï¼‰" class="w-full px-4 py-3 border border-heritage-900/15 rounded-md" />
                    <button id="auth-register" class="w-full bg-green-600 text-white py-3 rounded-md font-semibold hover:bg-green-700 transition">æ³¨å†Œ</button>
                    <div class="border-t border-heritage-900/10 my-2"></div>
                    <input id="login-phone" type="text" placeholder="æ‰‹æœºå·ï¼ˆç™»å½•ï¼‰" class="w-full px-4 py-3 border border-heritage-900/15 rounded-md" />
                    <input id="login-password" type="password" placeholder="å¯†ç ï¼ˆç™»å½•ï¼‰" class="w-full px-4 py-3 border border-heritage-900/15 rounded-md" />
                    <button id="auth-login" class="w-full bg-blue-600 text-white py-3 rounded-md font-semibold hover:bg-blue-700 transition">ç™»å½•</button>
                    <input id="reset-password" type="password" placeholder="æ–°å¯†ç ï¼ˆé‡ç½®ï¼‰" class="w-full px-4 py-3 border border-heritage-900/15 rounded-md" />
                    <button id="auth-reset" class="w-full bg-yellow-500 text-white py-3 rounded-md font-semibold hover:bg-yellow-600 transition">é‡ç½®å¯†ç </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer (è§¦åº•åˆ¤å®šä¼˜åŒ–) -->
    <footer class="bg-paper-50 pt-24 pb-12 will-change-transform"
            :style="`opacity: ${p(1.6, 1.9)}; transform: translateY(${30 - 30 * p(1.6, 1.9)}px)`">
        <div class="max-w-7xl mx-auto px-6">
            <div class="grid md:grid-cols-4 gap-12 mb-20">
                <div class="col-span-1 md:col-span-2">
                    <div class="text-3xl font-serif font-bold text-heritage-900 mb-6">HKSD Club.</div>
                    <p class="text-heritage-800/60 max-w-sm leading-relaxed mb-6">An exclusive community dedicated to the success of international scholars.</p>
                    <div class="flex gap-4 opacity-50">
                        <i data-lucide="instagram" class="w-5 h-5"></i>
                        <i data-lucide="linkedin" class="w-5 h-5"></i>
                    </div>
                </div>
                <div><h4 class="text-sm font-bold uppercase tracking-widest text-heritage-900 mb-6">Club</h4><ul class="space-y-4 text-heritage-800/60 font-serif text-sm"><li>Membership</li><li>Events</li><li>Our Story</li></ul></div>
                <div><h4 class="text-sm font-bold uppercase tracking-widest text-heritage-900 mb-6">Legal</h4><ul class="space-y-4 text-heritage-800/60 font-serif text-sm"><li>Privacy</li><li>Terms</li><li>Contact</li></ul></div>
            </div>
            <div class="border-t border-heritage-900/10 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-heritage-900/40 uppercase tracking-widest">
                <div>Â© 2016-2025 HKSD Club. All Rights Reserved.</div>
                <div>Design with Gravitas.</div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('alpine:initialized', () => {
             lucide.createIcons();
             setTimeout(() => lucide.createIcons(), 100); 
        });

        function app() {
            return {
                lang: 'sc',
                scrollY: 0,
                windowHeight: window.innerHeight,
                documentHeight: 0,
                
                handleScroll() {
                    this.scrollY = window.pageYOffset;
                },
                
                handleResize() {
                    this.windowHeight = window.innerHeight;
                    this.documentHeight = document.documentElement.scrollHeight;
                },

                // æ ¸å¿ƒè®¡ç®—å‡½æ•° (å¸¦è§¦åº•å¼ºåˆ¶å®Œæˆé€»è¾‘)
                p(startVh, endVh) {
                    // 1. è§¦åº•æ£€æµ‹ï¼šå¦‚æœæ»šåŠ¨åˆ°äº†åº•éƒ¨é™„è¿‘ (åå·®50px)ï¼Œå¼ºåˆ¶è¿”å› 1
                    // è¿™æ ·ä¿è¯åº•éƒ¨å…ƒç´ ä¸€å®šèƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œä¸ç®¡å±å¹•å¤šé«˜
                    const isAtBottom = (this.scrollY + this.windowHeight) >= (document.documentElement.scrollHeight - 50);
                    if (isAtBottom) return 1;

                    // 2. æ­£å¸¸è®¡ç®—è¿›åº¦
                    const start = startVh * this.windowHeight;
                    const end = endVh * this.windowHeight;
                    const progress = (this.scrollY - start) / (end - start);
                    return Math.min(Math.max(progress, 0), 1);
                },

                t: {
                    sc: {
                        menu_aca: 'å­¦æœ¯è§„åˆ’', menu_car: 'åä¼ç”Ÿæ¶¯', menu_hos: 'ç”Ÿæ´»ç¤¾åŒº',
                        hero_tag: 'æºè‡ªé¦™æ¸¯ï¼Œæ›´æ‡‚é¦™æ¸¯',
                        hero_h1: 'æ±‡ç”Ÿä¼š', 
                        hero_h2: 'ä½ æµ·å¤–æ¸©æš–çš„å®¶',
                        hero_p: 'ç•™å­¦ç”Ÿæ¶¯çš„åšå®åç›¾ã€‚æˆ‘ä»¬æ˜¯æ‚¨çš„ç”Ÿæ´»ç®¡å®¶ä¸èŒä¸šå¯¼å¸ˆã€‚ä»å…¥å­¦åˆ°å…¥èŒï¼ŒHKSD Club å…¨ç¨‹é™ªä¼´ã€‚',
                        hero_stat: 'å…¨çƒè®¤è¯æ ¡å‹',
                        btn_join: 'ç”³è¯·å…¥ä¼š', btn_explore: 'æ¢ç´¢æœåŠ¡',
                        
                        intro_title: 'æ‰€è°“åº•è•´ï¼Œæ˜¯æ—¶é—´çš„ç­”æ¡ˆ',
                        intro_text: 'è‡ª2016å¹´èµ·ï¼ŒHKSDæ·±è€•ç•™å­¦é¢†åŸŸã€‚æˆ‘ä»¬è§è¯äº†æ•°ä¸‡åå­¦å­ä»è¿·èŒ«åˆ°åšå®šï¼Œä»æ ¡å›­èµ°å‘ä¸–ç•Œçš„æ¯ä¸€ä¸ªé«˜å…‰æ—¶åˆ»ã€‚è¿™ä»½åšé‡çš„ç»éªŒï¼Œæ˜¯æˆ‘ä»¬æœ€å®è´µçš„èµ„äº§ã€‚',

                        service_title: 'ä¸‰å¤§æ ¸å¿ƒæ”¯æŸ±',
                        aca_title: 'Academia å­¦é™¢æ´¾', aca_desc: 'ä»¥ä¸¥è°¨çš„å­¦æœ¯æ€åº¦å¯¹å¾…æ¯ä¸€æ¬¡ç”³è¯·ã€‚æ·±åº¦æŒ–æ˜ä¸ªäººç‰¹è´¨ï¼ŒåŒ¹é…æœ€å¥‘åˆçš„åæ ¡èµ„æºã€‚ä¸åšæµæ°´çº¿ï¼Œåªåšä¼ ä¸–å“ã€‚', aca_tag1: 'åæ ¡å¯¼å¸ˆå›¢é˜Ÿ', aca_tag2: 'æ·±åº¦å­¦æœ¯è¾…å¯¼',
                        car_title: 'Career é¢†èˆªè€…', car_desc: 'ä¾æ‰˜åºå¤§çš„æ ¡å‹ç½‘ç»œï¼Œæ‰“é€šåä¼å†…éƒ¨é€šé“ã€‚è¿™ä¸æ˜¯ç®€å•çš„æ±‚èŒä¸­ä»‹ï¼Œè€Œæ˜¯å­¦é•¿å­¦å§çš„è–ªç«ç›¸ä¼ ã€‚',
                        hos_title: 'Hostel å½’å±åœ°', hos_desc: 'åœ¨ç¹åéƒ½å¸‚ä¸­ä¸ºæ‚¨ä¿ç•™ä¸€å¤„é™è°§ä¹‹æ‰€ã€‚ä¸¥æ ¼ç­›é€‰çš„é«˜ç´ è´¨é‚»é‡Œç¤¾åŒºï¼Œè®©æ¯ä¸€æ¬¡å½’å®¶éƒ½å……æ»¡å®‰å…¨æ„Ÿä¸å½’å±æ„Ÿã€‚',
                        
                        testi_title: 'æ ¡å‹ä¼ æ‰¿',
                        testimonials: [
                            {
                                name: 'Alex Zhang',
                                role: 'Class of 2018 | HKU',
                                avatar: 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                                content: 'HKSDç»™æˆ‘çš„æ„Ÿè§‰ä¸åŒäºå¸‚é¢ä¸Šçš„ä»»ä½•æœºæ„ã€‚è¿™é‡Œæœ‰ä¸€ç§â€œå®¶æ—â€èˆ¬çš„å‡èšåŠ›ã€‚å³ä½¿æ¯•ä¸šå¤šå¹´ï¼Œæˆ‘ä¾ç„¶èƒ½ä»è¿™ä¸ªç¤¾åŒºè·å¾—æ”¯æŒã€‚'
                            },
                            {
                                name: 'Chloe Lin',
                                role: 'Class of 2020 | CUHK',
                                avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                                content: 'å½“å¹´ç”³è¯·æ—¶çš„æ¯ä¸€ä»½æ–‡ä¹¦éƒ½ç»è¿‡äº†åå¤æ‰“ç£¨ï¼Œé‚£ç§å¯¹å®Œç¾çš„æ‰§ç€è®©æˆ‘æ·±å—æ„ŸåŠ¨ã€‚å¦‚ä»Šæˆ‘ä¹Ÿæˆä¸ºäº†å¯¼å¸ˆï¼Œå¸Œæœ›èƒ½å°†è¿™ä»½ä¸“ä¸šä¼ æ‰¿ä¸‹å»ã€‚'
                            },
                            {
                                name: 'Dr. Wang',
                                role: 'Class of 2017 | PolyU',
                                avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                                content: 'åœ¨HKSDå…¬å¯“åº¦è¿‡çš„æ—¶å…‰æ˜¯æˆ‘åšå£«ç”Ÿæ¶¯ä¸­æœ€æ¸©æš–çš„å›å¿†ã€‚è¿™é‡Œèšé›†äº†çœŸæ­£ä¼˜ç§€çš„çµé­‚ï¼Œæˆ‘ä»¬åœ¨æ·±å¤œçš„è®¨è®ºä¸­ç¢°æ’å‡ºäº†æ— æ•°æ€æƒ³ç«èŠ±ã€‚'
                            }
                        ]
                    },
                    tc: {
                        menu_aca: 'å­¸è¡“è¦åŠƒ', menu_car: 'åä¼ç”Ÿæ¶¯', menu_hos: 'ç”Ÿæ´»ç¤¾å€',
                        hero_tag: 'æºè‡ªé¦™æ¸¯ï¼Œæ›´æ‡‚é¦™æ¸¯',
                        hero_h1: 'åŒ¯ç”Ÿæœƒ', 
                        hero_h2: 'ä½ æµ·å¤–æº«æš–çš„å®¶',
                        hero_p: 'ç•™å­¸ç”Ÿæ¶¯çš„å …å¯¦å¾Œç›¾ã€‚æˆ‘å€‘æ˜¯æ‚¨çš„ç”Ÿæ´»ç®¡å®¶èˆ‡è·æ¥­å°å¸«ã€‚å¾å…¥å­¸åˆ°å…¥è·ï¼ŒHKSD Club å…¨ç¨‹é™ªä¼´ã€‚',
                        hero_stat: 'å…¨çƒèªè­‰æ ¡å‹',
                        btn_join: 'ç”³è«‹å…¥æœƒ', btn_explore: 'æ¢ç´¢æœå‹™',
                        
                        intro_title: 'æ‰€è¬‚åº•è˜Šï¼Œæ˜¯æ™‚é–“çš„ç­”æ¡ˆ',
                        intro_text: 'è‡ª2016å¹´èµ·ï¼ŒHKSDæ·±è€•ç•™å­¸é ˜åŸŸã€‚æˆ‘å€‘è¦‹è­‰äº†æ•¸è¬åå­¸å­å¾è¿·èŒ«åˆ°å …å®šï¼Œå¾æ ¡åœ’èµ°å‘ä¸–ç•Œçš„æ¯ä¸€å€‹é«˜å…‰æ™‚åˆ»ã€‚é€™ä»½åšé‡çš„ç¶“é©—ï¼Œæ˜¯æˆ‘å€‘æœ€å¯¶è²´çš„è³‡ç”¢ã€‚',

                        service_title: 'ä¸‰å¤§æ ¸å¿ƒæ”¯æŸ±',
                        aca_title: 'Academia å­¸é™¢æ´¾', aca_desc: 'ä»¥åš´è¬¹çš„å­¸è¡“æ…‹åº¦å°å¾…æ¯ä¸€æ¬¡ç”³è«‹ã€‚æ·±åº¦æŒ–æ˜å€‹äººç‰¹è³ªï¼ŒåŒ¹é…æœ€å¥‘åˆçš„åæ ¡è³‡æºã€‚ä¸åšæµæ°´ç·šï¼Œåªåšå‚³ä¸–å“ã€‚', aca_tag1: 'åæ ¡å°å¸«åœ˜éšŠ', aca_tag2: 'æ·±åº¦å­¸è¡“è¼”å°',
                        car_title: 'Career é ˜èˆªè€…', car_desc: 'ä¾è¨—é¾å¤§çš„æ ¡å‹ç¶²çµ¡ï¼Œæ‰“é€šåä¼å…§éƒ¨é€šé“ã€‚é€™ä¸æ˜¯ç°¡å–®çš„æ±‚è·ä»²ä»‹ï¼Œè€Œæ˜¯å­¸é•·å­¸å§çš„è–ªç«ç›¸å‚³ã€‚',
                        hos_title: 'Hostel æ­¸å±¬åœ°', hos_desc: 'åœ¨ç¹è¯éƒ½å¸‚ä¸­ç‚ºæ‚¨ä¿ç•™ä¸€è™•éœè¬ä¹‹æ‰€ã€‚åš´æ ¼ç¯©é¸çš„é«˜ç´ è³ªé„°é‡Œç¤¾å€ï¼Œè®“æ¯ä¸€æ¬¡æ­¸å®¶éƒ½å……æ»¿å®‰å…¨æ„Ÿèˆ‡æ­¸å±¬æ„Ÿã€‚',
                        
                        testi_title: 'æ ¡å‹å‚³æ‰¿',
                        testimonials: [
                            {
                                name: 'Alex Zhang',
                                role: 'Class of 2018 | HKU',
                                avatar: 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                                content: 'HKSDçµ¦æˆ‘çš„æ„Ÿè¦ºä¸åŒæ–¼å¸‚é¢ä¸Šçš„ä»»ä½•æ©Ÿæ§‹ã€‚é€™è£¡æœ‰ä¸€ç¨®ã€Œå®¶æ—ã€èˆ¬çš„å‡èšåŠ›ã€‚å³ä½¿ç•¢æ¥­å¤šå¹´ï¼Œæˆ‘ä¾ç„¶èƒ½å¾é€™å€‹ç¤¾å€ç²å¾—æ”¯æŒã€‚'
                            },
                            {
                                name: 'Chloe Lin',
                                role: 'Class of 2020 | CUHK',
                                avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                                content: 'ç•¶å¹´ç”³è«‹æ™‚çš„æ¯ä¸€ä»½æ–‡æ›¸éƒ½ç¶“éäº†åè¦†æ‰“ç£¨ï¼Œé‚£ç¨®å°å®Œç¾çš„åŸ·è‘—è®“æˆ‘æ·±å—æ„Ÿå‹•ã€‚å¦‚ä»Šæˆ‘ä¹Ÿæˆç‚ºäº†å°å¸«ï¼Œå¸Œæœ›èƒ½å°‡é€™ä»½å°ˆæ¥­å‚³æ‰¿ä¸‹å»ã€‚'
                            },
                            {
                                name: 'Dr. Wang',
                                role: 'Class of 2017 | PolyU',
                                avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                                content: 'åœ¨HKSDå…¬å¯“åº¦éçš„æ™‚å…‰æ˜¯æˆ‘åšå£«ç”Ÿæ¶¯ä¸­æœ€æº«æš–çš„å›æ†¶ã€‚é€™è£¡èšé›†äº†çœŸæ­£å„ªç§€çš„éˆé­‚ï¼Œæˆ‘å€‘åœ¨æ·±å¤œçš„è¨è«–ä¸­ç¢°æ’å‡ºäº†ç„¡æ•¸æ€æƒ³ç«èŠ±ã€‚'
                            }
                        ]
                    },
                    en: {
                        menu_aca: 'Academia', menu_car: 'Career Legacy', menu_hos: 'Residences',
                        hero_tag: 'From HK, For HK',
                        hero_h1: 'HKSD Club', 
                        hero_h2: 'Your Warm Home Abroad',
                        hero_p: 'The solid backing for your journey abroad. We are your life manager and career mentor. From admission to employment, HKSD Club is with you all the way.',
                        hero_stat: 'Verified Alumni',
                        btn_join: 'Apply for Membership', btn_explore: 'Explore Pillars',
                        
                        intro_title: 'Heritage is the Answer of Time',
                        intro_text: 'Since 2016, HKSD has cultivated the field of international education. We have witnessed tens of thousands of scholars transform from students to global leaders. This depth of experience is our greatest asset.',

                        service_title: 'The Three Pillars',
                        aca_title: 'Academia', aca_desc: 'Approaching applications with academic rigor. We delve deep into personal character to match elite university resources. Not mass production, but craftsmanship.', aca_tag1: 'Elite Mentors', aca_tag2: 'Academic Guidance',
                        car_title: 'Career', car_desc: 'Leveraging a massive alumni network to open internal doors at top firms. This is not recruitment; it is the passing of the torch.',
                        hos_title: 'Sanctuary', hos_desc: 'Reserving a quiet place for you in the bustling metropolis. A strictly curated high-quality neighborhood that brings a sense of security and belonging.',
                        
                        testi_title: 'The Legacy',
                        testimonials: [
                            {
                                name: 'Alex Zhang',
                                role: 'Class of 2018 | HKU',
                                avatar: 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                                content: 'HKSD feels different from any agency. There is a family-like cohesion. Even years after graduation, I still draw support from this community.'
                            },
                            {
                                name: 'Chloe Lin',
                                role: 'Class of 2020 | CUHK',
                                avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                                content: 'Every essay was polished to perfection. That dedication moved me. Now as a mentor, I hope to pass on this professionalism.'
                            },
                            {
                                name: 'Dr. Wang',
                                role: 'Class of 2017 | PolyU',
                                avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                                content: 'My time at the HKSD residence was the warmest memory of my PhD. It gathered truly brilliant souls, and we sparked countless ideas.'
                            }
                        ]
                    }
                }
            }
        }
    </script>

    <script>
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const byId = (id) => document.getElementById(id);

            const api = async (url, payload) => {
                const resp = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                return resp.json();
            };

            const sendCodeBtn = byId('auth-send-code');
            const verifyCodeBtn = byId('auth-verify-code');
            const registerBtn = byId('auth-register');
            const loginBtn = byId('auth-login');
            const resetBtn = byId('auth-reset');

            sendCodeBtn?.addEventListener('click', async () => {
                const phone = byId('auth-phone').value.trim();
                const purpose = byId('auth-purpose').value;
                try {
                    showToast('å‘é€éªŒè¯ç ...', 'loading');
                    const data = await api('/api/auth/send-code', { phone, purpose });
                    if (data.success) showToast('éªŒè¯ç å·²å‘é€', 'success'); else showToast(data.message || 'å‘é€å¤±è´¥', 'error');
                } catch (e) { showToast(e.message, 'error'); }
            });

            verifyCodeBtn?.addEventListener('click', async () => {
                const phone = byId('auth-phone').value.trim();
                const code = byId('auth-code').value.trim();
                try {
                    showToast('éªŒè¯ä¸­...', 'loading');
                    const data = await api('/api/auth/verify-code', { phone, code });
                    if (data.success) showToast('éªŒè¯æˆåŠŸ', 'success'); else showToast(data.message || 'éªŒè¯å¤±è´¥', 'error');
                } catch (e) { showToast(e.message, 'error'); }
            });

            registerBtn?.addEventListener('click', async () => {
                const phone = byId('auth-phone').value.trim();
                const code = byId('auth-code').value.trim();
                const password = byId('auth-password').value;
                const idCard = byId('auth-idcard').value.trim();
                const idCardName = byId('auth-idname').value.trim();
                try {
                    showToast('æ³¨å†Œä¸­...', 'loading');
                    const data = await api('/api/auth/register', { phone, code, password, idCard, idCardName });
                    if (data.success) showToast('æ³¨å†ŒæˆåŠŸ', 'success'); else showToast(data.message || 'æ³¨å†Œå¤±è´¥', 'error');
                } catch (e) { showToast(e.message, 'error'); }
            });

            loginBtn?.addEventListener('click', async () => {
                const phone = byId('login-phone').value.trim();
                const password = byId('login-password').value;
                try {
                    showToast('ç™»å½•ä¸­...', 'loading');
                    const data = await api('/api/auth/login', { phone, password });
                    if (data.success) {
                        localStorage.setItem('auth_token', data.token);
                        showToast('ç™»å½•æˆåŠŸ', 'success');
                    } else {
                        showToast(data.message || 'ç™»å½•å¤±è´¥', 'error');
                    }
                } catch (e) { showToast(e.message, 'error'); }
            });

            resetBtn?.addEventListener('click', async () => {
                const phone = byId('auth-phone').value.trim();
                const code = byId('auth-code').value.trim();
                const newPassword = byId('reset-password').value;
                try {
                    showToast('é‡ç½®å¯†ç ä¸­...', 'loading');
                    const data = await api('/api/auth/reset-password', { phone, code, newPassword });
                    if (data.success) showToast('å¯†ç é‡ç½®æˆåŠŸ', 'success'); else showToast(data.message || 'é‡ç½®å¤±è´¥', 'error');
                } catch (e) { showToast(e.message, 'error'); }
            });

            // ===== AI èŠå¤©åŠŸèƒ½ =====
            const chatFloatBtn = document.getElementById('chat-float-btn');
            const chatPanel = document.getElementById('chat-panel');
            const chatClose = document.getElementById('chat-close');
            const chatInput = document.getElementById('chat-input');
            const chatSendBtn = document.getElementById('chat-send-btn');
            const chatMessages = document.getElementById('chat-messages');

            let chatHistory = JSON.parse(localStorage.getItem('chat_history') || '[]');

            // æ¸²æŸ“èŠå¤©å†å²
            function renderMessages() {
                chatMessages.innerHTML = '';
                chatHistory.forEach(msg => {
                    const div = document.createElement('div');
                    div.className = `chat-message ${msg.role === 'user' ? 'user' : 'ai'}`;
                    div.textContent = msg.content;
                    chatMessages.appendChild(div);
                });
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // æ‰“å¼€/å…³é—­èŠå¤©çª—å£
            chatFloatBtn?.addEventListener('click', () => {
                // æš‚æ—¶ç§»é™¤ç™»å½•é™åˆ¶ï¼Œæ–¹ä¾¿æµ‹è¯•
                chatPanel.classList.add('open');
                renderMessages();
            });

            chatClose?.addEventListener('click', () => {
                chatPanel.classList.remove('open');
            });

            // å‘é€æ¶ˆæ¯
            async function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;

                const token = localStorage.getItem('auth_token') || 'test_token'; // æµ‹è¯•æ—¶ä½¿ç”¨é»˜è®¤token

                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                chatHistory.push({ role: 'user', content: message });
                renderMessages();
                chatInput.value = '';
                chatSendBtn.disabled = true;

                try {
                    console.log('[AI Chat] å‘é€æ¶ˆæ¯:', message);
                    console.log('[AI Chat] Token:', token);
                    
                    const requestBody = {
                        message: message,
                        history: chatHistory.slice(-10).map(m => ({ role: m.role, content: m.content }))
                    };
                    console.log('[AI Chat] Request Body:', requestBody);
                    console.log('[AI Chat] JSON String:', JSON.stringify(requestBody));
                    
                    const resp = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            message,
                            history: chatHistory.slice(-10).map(m => ({ role: m.role, content: m.content }))
                        })
                    });

                    console.log('[AI Chat] å“åº”çŠ¶æ€:', resp.status);
                    
                    if (!resp.ok) {
                        const errorText = await resp.text();
                        console.error('[AI Chat] HTTPé”™è¯¯:', resp.status, errorText);
                        showToast(`æœåŠ¡å™¨é”™è¯¯ (${resp.status})`, 'error');
                        return;
                    }

                    const data = await resp.json();
                    console.log('[AI Chat] å“åº”æ•°æ®:', data);
                    
                    if (data.success) {
                        chatHistory.push({ role: 'assistant', content: data.reply });
                        localStorage.setItem('chat_history', JSON.stringify(chatHistory));
                        renderMessages();
                        showToast('AI å›å¤æˆåŠŸ', 'success');
                    } else {
                        showToast(data.message || 'AI å›å¤å¤±è´¥', 'error');
                    }
                } catch (e) {
                    console.error('[AI Chat] å¼‚å¸¸:', e);
                    showToast(`ç½‘ç»œé”™è¯¯: ${e.message}`, 'error');
                } finally {
                    chatSendBtn.disabled = false;
                }
            }

            chatSendBtn?.addEventListener('click', sendMessage);
            chatInput?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // ===== å’¨è¯¢æŒ‰é’®äº¤äº’ =====
            const consultationMainBtn = document.getElementById('consultation-main-btn');
            const consultationOptions = document.getElementById('consultation-options');
            let consultationOpen = false;

            consultationMainBtn?.addEventListener('click', () => {
                consultationOpen = !consultationOpen;
                if (consultationOpen) {
                    consultationOptions.classList.add('show');
                } else {
                    consultationOptions.classList.remove('show');
                }
            });

            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­å’¨è¯¢èœå•
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#consultation-float')) {
                    consultationOptions.classList.remove('show');
                    consultationOpen = false;
                }
            });
        });
    </script>

    <!-- å³ä¸‹è§’å’¨è¯¢æŒ‰é’®ç»„ -->
    <div id="consultation-float">
        <div class="consultation-options" id="consultation-options">
            <button class="consultation-btn" onclick="window.open('https://wa.me/85212345678', '_blank')">
                ğŸ“ é¢„çº¦å’¨è¯¢
            </button>
            <button class="consultation-btn" onclick="window.open('https://wa.me/85287654321', '_blank')">
                ğŸ“§ åœ¨çº¿å’¨è¯¢
            </button>
        </div>
        <div id="consultation-main-btn" title="å’¨è¯¢æœåŠ¡">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
            </svg>
        </div>
    </div>

    <!-- AI èŠå¤©æµ®çª—æŒ‰é’® -->
    <div id="chat-float-btn" title="AI åŠ©æ‰‹">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
        </svg>
    </div>

    <!-- AI èŠå¤©ä¾§è¾¹æ  -->
    <div id="chat-panel">
        <div id="chat-header">
            <div>
                <h3 class="font-serif font-bold text-lg">AI åŠ©æ‰‹</h3>
                <p class="text-xs opacity-70 mt-1">HKSD Club ä¸“å±é¡¾é—®</p>
            </div>
            <button id="chat-close" class="text-gold-400 hover:text-gold-300 text-2xl leading-none">&times;</button>
        </div>
        <div id="chat-messages"></div>
        <div id="chat-input-area">
            <input id="chat-input" type="text" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." />
            <button id="chat-send-btn">å‘é€</button>
        </div>
    </div>
</body>
</html>